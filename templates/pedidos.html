{% extends "base.html" %}

{% block content %}
<div class="modulo-container">

    <h2 class="titulo-modulo">Gesti√≥n de Pedidos</h2>
    <p class="descripcion-modulo">
        Administra los pedidos registrados, asigna fechas de entrega y controla su estado.
    </p>

    <!-- LISTA DE PEDIDOS CON EDICI√ìN R√ÅPIDA -->
    <div class="tabla-card">
        <h3>üìã Pedidos registrados</h3>

        <table class="tabla">
            <thead>
                <tr>
                    <th>ID Pedido</th>
                    <th>Cliente</th>
                    <th>Cantidad</th>
                    <th>Total</th>
                    <th>Fecha Pedido</th>
                    <th>Fecha Entrega</th>
                    <th>Estado</th>
                    <th>Guardar</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
                {% for p in pedidos %}
                <tr>
                    <form method="POST" action="/actualizar_pedido/{{ p['id_pedido'] }}" class="form-inline-pedido">
                        <td><strong>#{{ p['id_pedido'] }}</strong></td>
                        <td>{{ p['nombre_cliente'] }}</td>
                        <td>{{ p['cantidad'] }}</td>
                        <td><strong>${{ "%.2f"|format(p['total']) }}</strong></td>
                        <td>{{ p['fecha_pedido'][:10] if p['fecha_pedido'] else 'N/A' }}</td>
                        
                        <!-- ‚úÖ FECHA DE ENTREGA EDITABLE -->
                        <td>
                            <input type="date" 
                                   name="fecha_entrega" 
                                   value="{{ p['fecha_entrega'] }}" 
                                   class="input-fecha"
                                   required>
                        </td>

                        <!-- ‚úÖ ESTADO DEL PEDIDO EDITABLE -->
                        <td>
                            <select name="estado" class="select-estado {{ p['estado'] }}">
                                <option value="pendiente" {% if p['estado']=='pendiente' %}selected{% endif %}>Pendiente</option>
                                <option value="en_proceso" {% if p['estado']=='en_proceso' %}selected{% endif %}>En proceso</option>
                                <option value="finalizado" {% if p['estado']=='finalizado' %}selected{% endif %}>Finalizado</option>
                                <option value="entregado" {% if p['estado']=='entregado' %}selected{% endif %}>Entregado</option>
                                <option value="cancelado" {% if p['estado']=='cancelado' %}selected{% endif %}>Cancelado</option>
                            </select>
                        </td>

                        <!-- ‚úÖ BOT√ìN GUARDAR CAMBIOS -->
                        <td>
                            <button type="submit" class="btn-accion guardar" title="Guardar cambios">üíæ</button>
                        </td>
                    </form>

                    <!-- ‚úÖ BOT√ìN ELIMINAR (FUERA DEL FORM) -->
                    <td>
                        <a href="/eliminar_pedido/{{ p['id_pedido'] }}" 
                           class="btn-accion eliminar" 
                           onclick="return confirm('¬øEliminar este pedido?')"
                           title="Eliminar">üóëÔ∏è</a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="10" class="sin-datos">No hay pedidos registrados</td>
                </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>

</div>

<style>
.modulo-container {
    padding: 2rem;
    max-width: 1400px;
    margin: 0 auto;
}

.titulo-modulo {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.descripcion-modulo {
    color: #666;
    margin-bottom: 2rem;
}

.form-card, .tabla-card {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.form-grupo {
    margin-bottom: 1rem;
}

.form-grupo label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.form-grupo select,
.form-grupo input {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.btn-guardar {
    width: 100%;
    padding: 0.75rem;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
}

.btn-guardar:hover {
    background: #218838;
}

.tabla {
    width: 100%;
    border-collapse: collapse;
}

.tabla th {
    background: #f8f9fa;
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid #dee2e6;
}

.tabla td {
    padding: 0.75rem;
    border-bottom: 1px solid #dee2e6;
}

.badge-estado {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 500;
}

.badge-estado.pendiente {
    background: #ffc107;
    color: #856404;
}

.badge-estado.en_proceso {
    background: #17a2b8;
    color: white;
}

.badge-estado.en_produccion {
    background: #17a2b8;
    color: white;
}

.badge-estado.finalizado {
    background: #6f42c1;
    color: white;
}

.badge-estado.entregado {
    background: #28a745;
    color: white;
}

.badge-estado.cancelado {
    background: #dc3545;
    color: white;
}

.btn-accion {
    text-decoration: none;
    padding: 0.4rem 0.8rem;
    margin: 0 0.25rem;
    font-size: 1.2rem;
    border: none;
    background: none;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.3s;
}

.btn-accion.guardar {
    background: #28a745;
    color: white;
}

.btn-accion.guardar:hover {
    background: #218838;
    transform: scale(1.1);
}

.btn-accion.eliminar {
    background: #dc3545;
    color: white;
    display: inline-block;
}

.btn-accion.eliminar:hover {
    background: #c82333;
    transform: scale(1.1);
}

/* Estilos para inputs en la tabla */
.form-inline-pedido {
    display: contents;
}

.input-fecha {
    padding: 0.4rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    width: 140px;
    font-size: 0.9rem;
}

.select-estado {
    padding: 0.4rem;
    border: 2px solid #ddd;
    border-radius: 4px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    width: 130px;
}

/* Colores para el select seg√∫n el estado */
.select-estado.pendiente {
    border-color: #ffc107;
    color: #856404;
}

.select-estado.en_proceso {
    border-color: #17a2b8;
    color: #0c5460;
}

.select-estado.finalizado {
    border-color: #6f42c1;
    color: #4a148c;
}

.select-estado.entregado {
    border-color: #28a745;
    color: #155724;
}

.select-estado.cancelado {
    border-color: #dc3545;
    color: #721c24;
}

.sin-datos {
    text-align: center;
    color: #999;
    font-style: italic;
    padding: 2rem !important;
}

/* Responsive */
@media (max-width: 1200px) {
    .tabla {
        font-size: 0.85rem;
    }
    
    .input-fecha, .select-estado {
        font-size: 0.8rem;
    }
}
</style>

<script>
// Cambiar el color del select cuando se cambia el estado
document.addEventListener('DOMContentLoaded', function() {
    const selects = document.querySelectorAll('.select-estado');
    
    selects.forEach(select => {
        select.addEventListener('change', function() {
            // Remover todas las clases de estado
            this.classList.remove('pendiente', 'en_proceso', 'finalizado', 'entregado', 'cancelado');
            // Agregar la clase del nuevo estado
            this.classList.add(this.value);
        });
    });
});
</script>

{% endblock %}